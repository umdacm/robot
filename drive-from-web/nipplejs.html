<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <script src="https://rawgit.com/yoannmoinet/nipplejs/v0.6.8/dist/nipplejs.min.js"></script>
    <title>Nipple.js Test</title>
  </head>
  <body>
    <h1>Nipple.js Test</h1>
    <h3>Left Stick</h3>
    <p><b>X:</b> <span id="left-x"></span></p>
    <p><b>Y:</b> <span id="left-y"></span></p>
    <h3>Right Stick</h3>
    <p><b>X:</b> <span id="right-x"></span></p>
    <p><b>Y:</b> <span id="right-y"></span></p>
    <div id="left-joystick-container" style="position:absolute;height:100%;width:50%;top:0;left:0"></div>
    <div id="right-joystick-container" style="position:absolute;height:100%;width:50%;top:0;left:50%"></div>
    <script>
      // Create WebSocket connection.
      const ws = new WebSocket('ws://robot.net.chandlerswift.com:10000');

      var leftStick = nipplejs.create({
        zone: document.getElementById('left-joystick-container'),
        color: "red",
      });

      var rightStick = nipplejs.create({
        zone: document.getElementById('right-joystick-container'),
        color: "red",
      });

      setInterval(function(){
        // TODO: only send if values change
        let stick = [[],[]];

        // stick[0][0] = navigator.getGamepads()[0]["axes"][0];
        // stick[0][1] = navigator.getGamepads()[0]["axes"][1] * -1;
        // stick[1][0] = navigator.getGamepads()[0]["axes"][2];
        // stick[1][1] = navigator.getGamepads()[0]["axes"][3] * -1;

        if (leftStick[0]) {
          document.getElementById("left-x").innerHTML = leftStick[0].frontPosition.x/50;
          document.getElementById("left-y").innerHTML = -leftStick[0].frontPosition.y/50;
        } else {
          document.getElementById("left-x").innerHTML = "";
          document.getElementById("left-y").innerHTML = "";
        }

        if (rightStick[0]) {
          document.getElementById("right-x").innerHTML = rightStick[0].frontPosition.x/50;
          document.getElementById("right-y").innerHTML = -rightStick[0].frontPosition.y/50;
        } else {
          document.getElementById("right-x").innerHTML = "";
          document.getElementById("right-y").innerHTML = "";
        }
        
        // ws.send(`DRV ${leftStick[0].frontPosition.x/50}  ${-leftStick[0].frontPosition.y/50}`);
        ws.send(`CAM ${rightStick[0].frontPosition.x/50} ${-rightStick[0].frontPosition.y/50}`);
      }, 100);
    </script>
  </body>
</html>

